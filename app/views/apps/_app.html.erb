<%- if app.batch_connect_app? -%>
  <%- app.batch_connect.sub_app_list.select(&:valid?).each do |sub_app| -%>
    <div class="col-sm-3 col-md-3">
      <%=
        link_to(
          new_batch_connect_session_context_path(token: sub_app.token),
          class: "thumbnail app",
          data: {
            toggle: "popover",
            content: manifest_markdown(sub_app.description),
            html: true,
            trigger: "hover",
            title: sub_app.title,
            container: "body"
          }
        ) do
      %>
        <div class="center-block" style="text-align: center">
          <%= app_icon_tag(app) %>
          <%= content_tag(:p, sub_app.title) %>
          <%= content_tag(:p, content_tag(:span, app.caption), class: "text-muted", style: "margin-top: 20px") if app.caption %>
        </div>
      <% end %>
    </div>
  <%- end -%>
<%- else -%>
  <div class="col-sm-3 col-md-3">
    <%= link_to app_path(app.name, app.type, app.owner), class: "thumbnail app", target: "_blank", data: {
      toggle: "popover",
      content: manifest_markdown(app.manifest.description),
      html: true,
      trigger: "hover",
      title: app.title,
      container: "body"
    } do %>
      <div class="center-block" style="text-align: center">
        <%= app_icon_tag(app) %>
        <%= content_tag(:p, app.title) %>
        <%= content_tag(:p, content_tag(:span, app.caption), class: "text-muted", style: "margin-top: 20px") if app.caption %>
      </div>
    <% end %>
  </div>
<%- end -%>
